{% if error %}
<div class="flex items-start gap-4">
    <div class="flex-shrink-0 h-8 w-8 rounded-full bg-red-100 flex items-center justify-center text-red-700 font-bold text-xs">ERR</div>
    <div class="bg-white p-4 rounded-2xl rounded-tl-none shadow-sm border border-red-100 text-sm text-red-600 max-w-[80%]">
        <p>{{ error }}</p>
    </div>
</div>
{% else %}
<div class="flex items-start gap-4 justify-end">
    <div class="bg-indigo-600 p-4 rounded-2xl rounded-tr-none shadow-sm text-sm text-white max-w-[80%]">
        <p>{{ message|safe }}</p>
    </div>
    <div class="flex-shrink-0 h-8 w-8 rounded-full bg-slate-200 flex items-center justify-center text-slate-600 font-bold text-xs">You</div>
</div>
<div class="flex items-start gap-4">
    <div class="flex-shrink-0 h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold text-xs">AI</div>
    <div class="bg-white p-4 rounded-2xl rounded-tl-none shadow-sm border border-slate-100 text-sm text-slate-700 max-w-[80%] space-y-2">
        <div class="prose prose-sm max-w-none text-slate-700">
            {{ answer|safe }}
        </div>
        {% if snippets %}
        <div class="mt-2 pt-2 border-t border-slate-100">
            <p class="text-xs font-semibold text-slate-500 mb-1">Sources:</p>
            <ul class="space-y-1">
                {% for snippet in snippets %}
                <li class="text-xs text-slate-400 truncate" title="{{ snippet.title }}">
                    - {% if snippet.download_url %}
                    <a class="hover:text-indigo-600 underline" href="{{ snippet.download_url }}" target="_blank">
                        {{ snippet.source }}
                    </a>
                    {% else %}
                    {{ snippet.source }}
                    {% endif %}
                    ({{ snippet.score_percent }}%)
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

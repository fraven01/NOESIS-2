<div class="space-y-3 rounded-lg border border-slate-200 bg-slate-50 p-4">
    <div class="flex items-center justify-between gap-3">
        <div class="space-y-1">
            <h3 class="text-sm font-semibold text-slate-900">Ingestion Tasks</h3>
            <p class="text-xs text-slate-600">
                {% if task_ids %}
                Started {{ task_ids|length }} tasks.
                {% else %}
                No tasks started recently.
                {% endif %}
            </p>
        </div>
        <button type="button" onclick="document.getElementById('ingestion-task-list').innerHTML = ''"
            class="inline-flex items-center rounded-md border border-slate-300 px-3 py-1.5 text-xs font-medium text-slate-700 shadow-sm transition hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-offset-2">
            Clear
        </button>
    </div>

    <div class="space-y-2" id="ingestion-task-list">
        {% if result %}
        <div class="rounded bg-white p-3 shadow-sm border border-slate-200">
            <div class="flex items-center justify-between mb-2">
                <span class="text-xs font-semibold text-slate-700">Batch Result</span>
                <span class="text-[10px] text-slate-400">{{ now|date:"H:i:s" }}</span>
            </div>
            <dl class="space-y-1 text-xs">
                <div class="flex justify-between">
                    <dt class="text-slate-500">Status:</dt>
                    <dd class="font-mono text-slate-900">{{ status }}</dd>
                </div>
                {% if url_count %}
                <div class="flex justify-between">
                    <dt class="text-slate-500">URLs:</dt>
                    <dd class="font-mono text-slate-900">{{ url_count }}</dd>
                </div>
                {% endif %}
                {% if result.origins %}
                <div class="mt-2 border-t border-slate-100 pt-2 space-y-2">
                    {% for origin in result.origins %}
                    <div class="space-y-1">
                        <div class="flex justify-between">
                            <dt class="text-slate-500">Source:</dt>
                            <dd class="font-mono text-slate-900 truncate max-w-[200px]" title="{{ origin.origin }}">{{
                                origin.origin }}</dd>
                        </div>
                        {% if origin.document_id %}
                        <div class="flex justify-between">
                            <dt class="text-slate-500 pl-2">Doc ID:</dt>
                            <dd class="font-mono text-slate-900" title="{{ origin.document_id }}">{{
                                origin.document_id|slice:":8" }}...</dd>
                        </div>
                        {% endif %}
                        {% if origin.chunk_count %}
                        <div class="flex justify-between">
                            <dt class="text-slate-500 pl-2">Chunks:</dt>
                            <dd class="font-mono text-slate-900">{{ origin.chunk_count }}</dd>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                {% if task_ids %}
                <div class="flex justify-between border-t border-slate-100 pt-2 mt-2">
                    <dt class="text-slate-500">Tasks:</dt>
                    <dd class="font-mono text-slate-900">{{ task_ids|join:", " }}</dd>
                </div>
                {% endif %}
                {% if transition %}
                <div class="border-t border-slate-100 pt-2 mt-2 space-y-1">
                    <p class="text-xs font-semibold text-slate-600 mb-1">Processing Decision</p>
                    {% if transition.decision %}
                    <div class="flex justify-between">
                        <dt class="text-slate-500">Decision:</dt>
                        <dd
                            class="font-mono {% if transition.decision == 'indexed' %}text-green-600{% elif transition.decision == 'queued' %}text-blue-600{% elif transition.decision == 'skipped' %}text-amber-600{% elif transition.decision == 'rejected' %}text-red-600{% else %}text-slate-900{% endif %}">
                            {{ transition.decision }}
                        </dd>
                    </div>
                    {% endif %}
                    {% if transition.reason %}
                    <div class="flex justify-between">
                        <dt class="text-slate-500">Reason:</dt>
                        <dd class="font-mono text-slate-900 truncate max-w-[200px]" title="{{ transition.reason }}">{{
                            transition.reason }}</dd>
                    </div>
                    {% endif %}
                    {% if transition.severity %}
                    <div class="flex justify-between">
                        <dt class="text-slate-500">Severity:</dt>
                        <dd
                            class="font-mono {% if transition.severity == 'error' %}text-red-600{% elif transition.severity == 'warning' %}text-amber-600{% else %}text-slate-900{% endif %}">
                            {{ transition.severity }}
                        </dd>
                    </div>
                    {% endif %}
                    {% if transition.document_id %}
                    <div class="flex justify-between">
                        <dt class="text-slate-500">Doc ID:</dt>
                        <dd class="font-mono text-slate-900" title="{{ transition.document_id }}">{{
                            transition.document_id|slice:":8" }}...</dd>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </dl>
            {% if error %}
            <div class="mt-2 text-xs text-red-600 bg-red-50 p-2 rounded">
                {{ error }}
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

# RAG Configuration (Code Index)

## Source of Truth

- ai_core/settings.py (RAG defaults)
- ai_core/rag/* (env + settings usage)
- ai_core/graphs/technical/retrieval_augmented_generation.py
- ai_core/graphs/technical/rag_retrieval.py
- documents/pipeline.py (ingestion pipeline config)

## Environment Variables (os.getenv)

retrieval_graph:
- RAG_CHAT_HISTORY_MAX_MESSAGES
- RAG_CHAT_HISTORY_MAX_CHARS
- RAG_CONTEXT_TOKEN_BUDGET
- RAG_CHUNK_TARGET_TOKENS
- RAG_CONTEXT_OVERSAMPLE_FACTOR
- RAG_CONFIDENCE_MAX_RETRIES
- RAG_CONFIDENCE_TOP_SCORE
- RAG_CONFIDENCE_SCORE_DELTA

query_transform:
- RAG_QUERY_MAX_VARIANTS
- RAG_QUERY_TRANSFORM_MODE

query_planner:
- RAG_QUERY_PLANNER_MODE

semantic_cache:
- RAG_SEMANTIC_CACHE_ENABLED
- RAG_SEMANTIC_CACHE_TTL_S
- RAG_SEMANTIC_CACHE_MAX_ITEMS
- RAG_SEMANTIC_CACHE_SIM_THRESHOLD

rerank:
- RAG_RERANK_MODE
- RAG_RERANK_POOL
- RAG_RERANK_QUALITY_MODE
- RAG_RERANK_WEIGHT_MODE
- RAG_RERANK_CLICK_WEIGHT
- RAG_RERANK_WEIGHT_ALPHA
feedback:
- RAG_FEEDBACK_ENABLED

answer_guardrails:
- RAG_GUARDRAIL_MIN_SNIPPETS
- RAG_GUARDRAIL_MIN_TOP_SCORE

candidate_policy:
- RAG_CANDIDATE_POLICY
- RAG_MAX_CANDIDATES

vector_client:
- RAG_HYBRID_ALPHA
- RAG_MIN_SIM
- RAG_TRGM_LIMIT
- RAG_DISTANCE_SCORE_MODE
- RAG_HYDE_ENABLED
- RAG_HYDE_MODEL_LABEL
- RAG_HYDE_MAX_CHARS
- RAG_LEXICAL_MODE
- RAG_LEXICAL_CONTEXTUAL_ENABLED
- RAG_RRF_K
- RAG_NEAR_DUPLICATE_STRATEGY
- RAG_NEAR_DUPLICATE_THRESHOLD
- RAG_NEAR_DUPLICATE_PROBE_LIMIT
- RAG_NEAR_DUPLICATE_REQUIRE_UNIT_NORM
- RAG_INDEX_KIND
- RAG_HNSW_EF_SEARCH
- RAG_IVF_PROBES
- RAG_STATEMENT_TIMEOUT_MS
- RAG_RETRY_ATTEMPTS
- RAG_RETRY_BASE_DELAY_MS
- RAG_DATABASE_URL
- RAG_VECTOR_SCHEMA
- DEV_TENANT_SCHEMA

rag_retrieval_graph:
- RAG_REFERENCE_EXPANSION
- RAG_REFERENCE_EXPANSION_LIMIT
- RAG_REFERENCE_EXPANSION_TOP_K

## Django Settings (getattr(settings, ...))

embedding_client:
- EMBEDDINGS_PROVIDER
- EMBEDDINGS_MODEL_PRIMARY
- EMBEDDINGS_MODEL_FALLBACK
- EMBEDDINGS_BATCH_SIZE
- EMBEDDINGS_TIMEOUT_SECONDS

vector_spaces:
- RAG_VECTOR_STORES
- RAG_VECTOR_DEFAULT_SCOPE
- RAG_EMBEDDING_PROFILES
- RAG_DEFAULT_EMBEDDING_PROFILE
- RAG_ROUTING_RULES_PATH
- RAG_ROUTING_FLAGS
- RAG_USE_COLLECTION_ROUTING

chunking:
- RAG_CHUNKER_MODE
- RAG_LATE_CHUNK_MODEL
- RAG_LATE_CHUNK_MAX_TOKENS
- RAG_AGENTIC_CHUNK_MODEL
- RAG_AGENTIC_CHUNK_MAX_RETRIES
- RAG_AGENTIC_CHUNK_TIMEOUT
- RAG_AGENTIC_CHUNK_RATE_LIMIT
- RAG_AGENTIC_CHUNK_TOKEN_BUDGET
- RAG_ENABLE_QUALITY_METRICS
- RAG_QUALITY_EVAL_MODEL
- RAG_QUALITY_MAX_WORKERS
- RAG_QUALITY_SAMPLE_RATE
- RAG_QUALITY_TIMEOUT
- RAG_CHUNK_TARGET_TOKENS
- RAG_CHUNK_OVERLAP_TOKENS
- RAG_USE_EMBEDDING_SIMILARITY
- RAG_ALLOW_JACCARD_FALLBACK
- RAG_CHUNKING_WINDOW_SIZE
- RAG_CHUNKING_BATCH_SIZE
- RAG_USE_CONTENT_BASED_IDS
- RAG_ADAPTIVE_CHUNKING_ENABLED
- RAG_ASSET_CHUNKS_ENABLED

contextual_enrichment:
- RAG_CONTEXTUAL_ENRICHMENT
- RAG_CONTEXTUAL_ENRICHMENT_MODEL
- RAG_CONTEXTUAL_ENRICHMENT_MAX_DOC_CHARS
- RAG_CONTEXTUAL_ENRICHMENT_MAX_CHUNK_CHARS
- RAG_CONTEXTUAL_ENRICHMENT_MAX_CHUNKS
- RAG_CONTEXTUAL_ENRICHMENT_MAX_PREFIX_CHARS
- RAG_CONTEXTUAL_ENRICHMENT_MAX_PREFIX_WORDS

parents:
- RAG_PARENT_MAX_BYTES

vector_store_guardrails:
- RAG_INTERNAL_KEYS

crawler:
- CRAWLER_DEFAULT_WORKFLOW_ID
- CRAWLER_MAX_DOCUMENT_BYTES
- CRAWLER_IDEMPOTENCY_CACHE_PREFIX
- CRAWLER_IDEMPOTENCY_CACHE_TTL_SECONDS

documents_pipeline:
- DOCUMENT_PIPELINE_PDF_SAFE_MODE
- DOCUMENT_PIPELINE_CAPTION_MIN_CONFIDENCE_DEFAULT
- DOCUMENT_PIPELINE_CAPTION_MIN_CONFIDENCE_BY_COLLECTION
- DOCUMENT_PIPELINE_ENABLE_OCR
- DOCUMENT_PIPELINE_ENABLE_NOTES_IN_PPTX
- DOCUMENT_PIPELINE_EMIT_EMPTY_SLIDES
- DOCUMENT_PIPELINE_ENABLE_ASSET_CAPTIONS
- DOCUMENT_PIPELINE_OCR_FALLBACK_CONFIDENCE
- DOCUMENT_PIPELINE_USE_READABILITY_HTML_EXTRACTION
- DOCUMENT_PIPELINE_OCR_RENDERER
- DOCUMENT_PIPELINE_CONFIG

## Defaults

from ai_core/settings.py:
- TOPK_DEFAULT=5
- TOPK_MAX=10
- TOPK_MIN=1
- HYBRID_ALPHA_DEFAULT=0.7
- MIN_SIM_DEFAULT=0.15
- DIVERSIFY_STRENGTH_DEFAULT=0.3

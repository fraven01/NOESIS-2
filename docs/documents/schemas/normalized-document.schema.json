{
  "$defs": {
    "Asset": {
      "additionalProperties": false,
      "description": "Representation of an extracted multimodal asset.",
      "properties": {
        "bbox": {
          "anyOf": [
            {
              "items": {
                "type": "number"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Normalized bounding box [x0, y0, x1, y1] within the page.",
          "title": "Bbox"
        },
        "blob": {
          "description": "Blob containing the asset payload or pointer.",
          "discriminator": {
            "mapping": {
              "external": "#/$defs/ExternalBlob",
              "file": "#/$defs/FileBlob",
              "inline": "#/$defs/InlineBlob"
            },
            "propertyName": "type"
          },
          "oneOf": [
            {
              "$ref": "#/$defs/FileBlob"
            },
            {
              "$ref": "#/$defs/InlineBlob"
            },
            {
              "$ref": "#/$defs/ExternalBlob"
            }
          ],
          "title": "Blob Locator"
        },
        "caption_confidence": {
          "anyOf": [
            {
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Confidence for model generated captions (0.0-1.0).",
          "title": "Caption Confidence"
        },
        "caption_method": {
          "description": "Method used to derive the text description or caption.",
          "enum": [
            "vlm_caption",
            "ocr_only",
            "manual",
            "none"
          ],
          "title": "Caption Method",
          "type": "string"
        },
        "caption_model": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Model identifier if captions were generated by a VLM.",
          "title": "Caption Model"
        },
        "checksum": {
          "description": "Checksum ensuring integrity of the asset payload.",
          "title": "Checksum",
          "type": "string"
        },
        "context_after": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional textual context following the asset (<= 2048 bytes).",
          "title": "Context After"
        },
        "context_before": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional textual context preceding the asset (<= 2048 bytes).",
          "title": "Context Before"
        },
        "created_at": {
          "description": "UTC timestamp when the asset was generated or ingested.",
          "format": "date-time",
          "title": "Created At",
          "type": "string"
        },
        "media_type": {
          "description": "Media type describing the asset content (lowercase type/subtype, no parameters).",
          "title": "Media Type",
          "type": "string"
        },
        "ocr_text": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional OCR extracted text for the asset (<= 8192 bytes).",
          "title": "Ocr Text"
        },
        "origin_uri": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional URI of the source that produced the asset.",
          "title": "Origin Uri"
        },
        "page_index": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional page index the asset originates from.",
          "title": "Page Index"
        },
        "ref": {
          "$ref": "#/$defs/AssetRef",
          "description": "Reference identifiers for the asset."
        },
        "text_description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional textual description for the asset (<= 2048 bytes).",
          "title": "Text Description"
        }
      },
      "required": [
        "ref",
        "media_type",
        "blob",
        "caption_method",
        "created_at",
        "checksum"
      ],
      "title": "Document Asset",
      "type": "object"
    },
    "AssetRef": {
      "additionalProperties": false,
      "description": "Reference to an extracted asset belonging to a document.",
      "properties": {
        "asset_id": {
          "description": "Unique identifier of the asset.",
          "format": "uuid",
          "title": "Asset Id",
          "type": "string"
        },
        "collection_id": {
          "anyOf": [
            {
              "format": "uuid",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional collection identifier for the asset.",
          "title": "Collection Id"
        },
        "document_id": {
          "description": "Identifier of the parent document.",
          "format": "uuid",
          "title": "Document Id",
          "type": "string"
        },
        "tenant_id": {
          "description": "Tenant identifier owning the asset.",
          "title": "Tenant Id",
          "type": "string"
        },
        "workflow_id": {
          "description": "Workflow identifier linking the asset to its document workflow.",
          "title": "Workflow Id",
          "type": "string"
        }
      },
      "required": [
        "tenant_id",
        "workflow_id",
        "asset_id",
        "document_id"
      ],
      "title": "Asset Reference",
      "type": "object"
    },
    "DocumentMeta": {
      "additionalProperties": false,
      "description": "Metadata captured during ingestion of a document.",
      "properties": {
        "crawl_timestamp": {
          "anyOf": [
            {
              "format": "date-time",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Timestamp when the document was crawled or collected.",
          "title": "Crawl Timestamp"
        },
        "external_ref": {
          "anyOf": [
            {
              "additionalProperties": {
                "type": "string"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional external reference identifiers provided by source systems (<= 16 entries; keys <= 128 chars, values <= 512 chars; limits enforced).",
          "title": "External Ref"
        },
        "language": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional BCP-47 language tag representing the primary language.",
          "title": "Language"
        },
        "origin_uri": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Original source URI for the ingested document.",
          "title": "Origin Uri"
        },
        "tags": {
          "description": "Optional collection of tags for retrieval and filtering.",
          "items": {
            "type": "string"
          },
          "title": "Tags",
          "type": "array"
        },
        "tenant_id": {
          "description": "Tenant identifier the metadata belongs to.",
          "title": "Tenant Id",
          "type": "string"
        },
        "title": {
          "anyOf": [
            {
              "maxLength": 256,
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional human readable document title.",
          "title": "Title"
        },
        "workflow_id": {
          "description": "Workflow identifier that groups document ingestion context.",
          "title": "Workflow Id",
          "type": "string"
        }
      },
      "required": [
        "tenant_id",
        "workflow_id"
      ],
      "title": "Document Metadata",
      "type": "object"
    },
    "DocumentRef": {
      "additionalProperties": false,
      "description": "Stable reference to a stored document.",
      "properties": {
        "collection_id": {
          "anyOf": [
            {
              "format": "uuid",
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional collection containing the document.",
          "title": "Collection Id"
        },
        "document_id": {
          "description": "Unique identifier of the document.",
          "format": "uuid",
          "title": "Document Id",
          "type": "string"
        },
        "tenant_id": {
          "description": "Tenant identifier owning the document.",
          "title": "Tenant Id",
          "type": "string"
        },
        "version": {
          "anyOf": [
            {
              "maxLength": 64,
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional semantic version marker for the ingested document.",
          "title": "Version"
        },
        "workflow_id": {
          "description": "Workflow identifier that produced or manages the document.",
          "title": "Workflow Id",
          "type": "string"
        }
      },
      "required": [
        "tenant_id",
        "workflow_id",
        "document_id"
      ],
      "title": "Document Reference",
      "type": "object"
    },
    "ExternalBlob": {
      "additionalProperties": false,
      "properties": {
        "kind": {
          "description": "Type of external storage backend for the blob (http/https for web URLs).",
          "enum": [
            "s3",
            "gcs",
            "http",
            "https"
          ],
          "title": "Kind",
          "type": "string"
        },
        "sha256": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional checksum when provided by the external source.",
          "title": "Sha256"
        },
        "type": {
          "const": "external",
          "description": "Discriminator identifying an external blob reference.",
          "title": "Type",
          "type": "string"
        },
        "uri": {
          "description": "External URI or object identifier.",
          "title": "Uri",
          "type": "string"
        }
      },
      "required": [
        "type",
        "kind",
        "uri"
      ],
      "title": "ExternalBlob",
      "type": "object"
    },
    "FileBlob": {
      "additionalProperties": false,
      "properties": {
        "sha256": {
          "description": "Hex encoded SHA-256 checksum of the blob contents.",
          "title": "Sha256",
          "type": "string"
        },
        "size": {
          "description": "Blob size in bytes.",
          "title": "Size",
          "type": "integer"
        },
        "type": {
          "const": "file",
          "description": "Discriminator identifying a file blob.",
          "title": "Type",
          "type": "string"
        },
        "uri": {
          "description": "URI for fetching the blob from storage.",
          "title": "Uri",
          "type": "string"
        }
      },
      "required": [
        "type",
        "uri",
        "sha256",
        "size"
      ],
      "title": "FileBlob",
      "type": "object"
    },
    "InlineBlob": {
      "additionalProperties": false,
      "properties": {
        "base64": {
          "description": "Base64 encoded payload contents.",
          "title": "Base64",
          "type": "string"
        },
        "media_type": {
          "description": "RFC compliant media type without parameters (type/subtype lowercase).",
          "title": "Media Type",
          "type": "string"
        },
        "sha256": {
          "description": "Hex encoded SHA-256 checksum of the payload.",
          "title": "Sha256",
          "type": "string"
        },
        "size": {
          "description": "Payload size in bytes.",
          "title": "Size",
          "type": "integer"
        },
        "type": {
          "const": "inline",
          "description": "Discriminator identifying inline data blobs.",
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "type",
        "media_type",
        "base64",
        "sha256",
        "size"
      ],
      "title": "InlineBlob",
      "type": "object"
    }
  },
  "additionalProperties": false,
  "description": "Complete normalized document with metadata and optional assets.",
  "properties": {
    "assets": {
      "description": "Assets that were extracted from the document.",
      "items": {
        "$ref": "#/$defs/Asset"
      },
      "title": "Assets",
      "type": "array"
    },
    "blob": {
      "description": "Primary blob storing the document contents.",
      "discriminator": {
        "mapping": {
          "external": "#/$defs/ExternalBlob",
          "file": "#/$defs/FileBlob",
          "inline": "#/$defs/InlineBlob"
        },
        "propertyName": "type"
      },
      "oneOf": [
        {
          "$ref": "#/$defs/FileBlob"
        },
        {
          "$ref": "#/$defs/InlineBlob"
        },
        {
          "$ref": "#/$defs/ExternalBlob"
        }
      ],
      "title": "Blob Locator"
    },
    "checksum": {
      "description": "Checksum for the main document blob.",
      "title": "Checksum",
      "type": "string"
    },
    "created_at": {
      "description": "UTC timestamp when the document was ingested into the system.",
      "format": "date-time",
      "title": "Created At",
      "type": "string"
    },
    "meta": {
      "$ref": "#/$defs/DocumentMeta",
      "description": "Associated metadata for the document."
    },
    "ref": {
      "$ref": "#/$defs/DocumentRef",
      "description": "Identifier reference for the document."
    },
    "source": {
      "anyOf": [
        {
          "enum": [
            "upload",
            "crawler",
            "integration",
            "other"
          ],
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Ingestion channel describing how the document entered the platform (e.g. `crawler`, `upload`). This is distinct from `meta.external_ref['provider']`, which names the upstream system or integration.",
      "title": "Source"
    }
  },
  "required": [
    "ref",
    "meta",
    "blob",
    "checksum",
    "created_at"
  ],
  "title": "Normalized Document",
  "type": "object"
}
